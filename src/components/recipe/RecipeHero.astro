---
import { Image } from "astro:assets";
import RecipeMetaInfo from "./RecipeMetaInfo.astro";
import RecipeAuthor from "./RecipeAuthor.astro";
import TableOfContents from "./TableOfContents.astro";
import SocialMediaButtons from "./SocialMediaButtons.astro";
import RatingDisplay from "./RatingDisplay.tsx";
import { getCategoryUrl } from "../../utils/categoryUtils";

interface TocItem {
  id: string;
  label: string;
  iconType?: "introduction" | "facts" | "ingredients" | "directions" | "nutrition" | "tips";
}

interface Props {
  title: string;
  description?: string;
  heroImage: {
    src: string;
    alt: string;
    width?: number;
    height?: number;
  };
  category?: string;
  categories?: string[];
  timing?: {
    totalTime?: string;
    cookTime?: string;
  };
  cuisine?: string;
  servings?: number | string;
  difficulty?: string;
  tocItems?: TocItem[];
  recipeSlug: string;
}

const {
  title,
  description,
  heroImage,
  category,
  categories = [],
  timing,
  cuisine,
  servings,
  difficulty,
  tocItems = [],
  recipeSlug,
} = Astro.props;

const mainCategory = category || categories[0] || "Rezept";
---

<section class="mb-8 overflow-hidden rounded-lg bg-white shadow-lg">
  <div class="grid grid-cols-1 gap-0 md:grid-cols-5">
    <!-- Hero Image - Left Side -->
    <div class="md:col-span-2">
      <figure class="h-full min-h-[400px] md:min-h-[600px]">
        <Image
          src={heroImage.src}
          alt={heroImage.alt}
          width={heroImage.width || 800}
          height={heroImage.height || 1067}
          class="h-full w-full object-cover"
          loading="eager"
          format="webp"
          quality={90}
        />
      </figure>
    </div>

    <!-- Recipe Info - Right Side -->
    <div class="flex flex-col justify-between p-8 md:col-span-3 md:p-12">
      <div>
        <!-- Category Badge -->
        <div class="mb-4">
          <a
            href={getCategoryUrl(mainCategory)}
            class="text-accent hover:text-accent-dark inline-block px-3 py-1 text-sm font-semibold tracking-wide uppercase transition-colors"
          >
            {mainCategory}
          </a>
        </div>

        <!-- Title -->
        <h1 class="mb-4 text-3xl leading-tight font-bold text-gray-900 md:text-4xl lg:text-5xl">
          {title}
        </h1>

        <!-- Description -->
        {description && <p class="mb-6 text-lg leading-relaxed text-gray-600">{description}</p>}

        <!-- Meta Info (Time, Cuisine, Servings, Difficulty) -->
        <div class="mb-6">
          <RecipeMetaInfo
            cookTime={timing?.totalTime || timing?.cookTime}
            cuisine={cuisine}
            servings={servings}
            difficulty={difficulty}
          />
        </div>

        <!-- Author Info & Rating Display -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <RecipeAuthor />
          <RatingDisplay recipeSlug={recipeSlug} client:load />
        </div>
      </div>

      <!-- Action Buttons & Social Media -->
      <div
        class="mt-6 flex flex-col items-start justify-between gap-4 border-gray-200 pt-6 md:flex-row md:items-center"
      >
        <!-- Action Buttons -->
        <div class="flex items-center gap-3">
          <button
            type="button"
            class="focus:ring-accent flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-4 py-2 transition-colors hover:bg-gray-50 focus:ring-2 focus:outline-none"
            aria-label="Zu Favoriten hinzufügen"
            id="favorite-btn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="text-accent h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
              ></path>
            </svg>
          </button>

          <button
            type="button"
            class="focus:ring-accent flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-4 py-2 transition-colors hover:bg-gray-50 focus:ring-2 focus:outline-none"
            aria-label="Lesezeichen setzen"
            id="bookmark-btn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-gray-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"></path>
            </svg>
          </button>

          <button
            type="button"
            class="focus:ring-accent flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-4 py-2 transition-colors hover:bg-gray-50 focus:ring-2 focus:outline-none"
            aria-label="Rezept teilen"
            id="share-btn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-gray-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Social Media Buttons -->
        <div class="md:ml-auto">
          <SocialMediaButtons
            recipeTitle={title}
            recipeUrl={Astro.url.toString()}
            recipeImage={heroImage.src}
            recipeDescription={description || title}
          />
        </div>
      </div>

      <!-- Table of Contents -->
      {
        tocItems && tocItems.length > 0 && (
          <div class="mt-6">
            <TableOfContents items={tocItems} />
          </div>
        )
      }
    </div>
  </div>
</section>

<script>
  // Simple interaction handlers
  document.getElementById("favorite-btn")?.addEventListener("click", () => {
    alert("Zu Favoriten hinzugefügt!");
  });

  document.getElementById("bookmark-btn")?.addEventListener("click", () => {
    alert("Lesezeichen gesetzt!");
  });

  document.getElementById("share-btn")?.addEventListener("click", () => {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href,
      });
    } else {
      navigator.clipboard.writeText(window.location.href);
      alert("Link in Zwischenablage kopiert!");
    }
  });
</script>
