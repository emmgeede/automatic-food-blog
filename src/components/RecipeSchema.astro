---
/**
 * RecipeSchema Component
 *
 * Generates JSON-LD structured data for Google Recipe Schema
 * Based on: https://schema.org/Recipe
 *
 * Uses the recipeSchema from the JSON data if available, otherwise generates it from postData
 */

import type { CollectionEntry } from "astro:content";

interface Props {
  postData: CollectionEntry<"blog">["data"];
  slug: string;
}

const { postData, slug } = Astro.props;

// Build the recipe URL
const baseUrl = Astro.site?.href || Astro.url.origin + "/";
const recipeUrl = `${baseUrl}blog/${slug}`;

// Use the recipeSchema from JSON if available, otherwise build it
let schema = postData.recipeSchema || {};

// If the schema doesn't have a URL, add it
if (!schema.url) {
  schema = {
    ...schema,
    url: recipeUrl,
  };
}

// Clean up undefined values
const cleanedSchema = JSON.parse(
  JSON.stringify(schema, (key, value) => (value === undefined ? undefined : value))
);
---

<script type="application/ld+json" set:html={JSON.stringify(cleanedSchema, null, 2)} />
