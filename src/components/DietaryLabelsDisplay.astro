---
/**
 * Container-Komponente, die alle aktiven Dietary Labels fÃ¼r ein Rezept anzeigt
 */
import DietaryBadge from './DietaryBadge.astro';
import { getDietaryLabelDisplay, getActiveDietaryLabels } from '../utils/dietaryDetection';
import type { DietaryLabels } from '../utils/dietaryDetection';

export interface Props {
  dietaryLabels?: DietaryLabels;
  size?: 'sm' | 'md' | 'lg';
  className?: string;
  clickable?: boolean;
  maxDisplay?: number; // Maximum number of labels to display
}

const { dietaryLabels, size = 'md', className = '', clickable = true, maxDisplay = 3 } = Astro.props;

// Hole alle aktiven Labels
const activeLabels = getActiveDietaryLabels(dietaryLabels);

// Wenn keine Labels aktiv sind, nichts rendern
if (activeLabels.length === 0) {
  return null;
}

// Labels mit Display-Informationen
const labelDisplays = activeLabels
  .map(key => {
    const display = getDietaryLabelDisplay(key as keyof DietaryLabels);
    return display ? { key, ...display } : null;
  })
  .filter(Boolean);

// Limit to maxDisplay labels
const displayedLabels = labelDisplays.slice(0, maxDisplay);
const remainingCount = labelDisplays.length - maxDisplay;
---

{labelDisplays.length > 0 && (
  <div class:list={['dietary-labels-container', 'flex flex-wrap gap-2', className]}>
    {displayedLabels.map(labelDisplay => (
      <DietaryBadge
        label={labelDisplay!.label}
        labelKey={labelDisplay!.key}
        size={size}
        clickable={clickable}
      />
    ))}
    {remainingCount > 0 && (
      <span class:list={[
        'inline-flex items-center px-3 py-1 rounded-full bg-gray-200 text-gray-700 font-medium',
        size === 'sm' && 'text-xs',
        size === 'md' && 'text-sm',
        size === 'lg' && 'text-base'
      ]}>
        +{remainingCount}
      </span>
    )}
  </div>
)}
