---
import { getCollection, type CollectionEntry } from "astro:content";
import BlogPostLayout from "../../layouts/BlogPostLayout.astro";
import RecipeHeader from "../../components/recipe/RecipeHeader.astro";
import RecipeIntro from "../../components/recipe/RecipeIntro.astro";
import RecipeFacts from "../../components/recipe/RecipeFacts.astro";
import RecipeIngredients from "../../components/recipe/RecipeIngredients.astro";
import RecipeInstructions from "../../components/recipe/RecipeInstructions.astro";
import RecipeNutrition from "../../components/recipe/RecipeNutrition.astro";
import RecipeTips from "../../components/recipe/RecipeTips.astro";
import RecipeConclusion from "../../components/recipe/RecipeConclusion.astro";
import RecipeFooter from "../../components/recipe/RecipeFooter.astro";

type BlogEntry = CollectionEntry<"blog">;

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");

  return blogEntries.map((entry) => ({
    params: { slug: entry.data.metadata.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props as { entry: BlogEntry };

const { metadata, content, images, ingredients, nutrition, timing, taxonomy } = entry.data;
---

<BlogPostLayout
  title={metadata?.title || "Untertitelter Beitrag"}
  description={metadata?.description || ""}
  postData={entry.data}
>
  <article class="recipe" itemscope itemtype="https://schema.org/Recipe">
    <RecipeHeader {metadata} {taxonomy} {timing} {nutrition} {images} />

    <div class="content">
      <div class="content__main">
        <RecipeIntro {content} {images} />
        <RecipeFacts {content} {images} />
        <RecipeIngredients {ingredients} />
        <RecipeInstructions {content} {images} />
        <RecipeNutrition {nutrition} />
        <RecipeTips {content} {images} />
        <RecipeConclusion {content} />
        <RecipeFooter {taxonomy} />
      </div>
      <aside class="content__sidebar">SIDEBAR</aside>
    </div>
  </article>

  <!-- Screen Reader Only Styles -->
  <style>
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>

  <style lang="scss">
    .content {
      display: grid;
      grid-template-columns: 3fr 1fr;
      gap: 2rem;
      max-width: 80%;

      &__main {
      }
      &__sidebar {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }
    }

    .recipe-header {
      .head-band {
        justify-content: center;
        align-items: center;
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
        padding: 1.2rem;
        background-color: var(--color-neutral-200);

        h1 {
          font-size: 2em;
        }

        &__buttons {
          display: flex;
          gap: 1rem;
        }

        &__breadcrumb {
          font-size: 0.8em;
          flex-direction: row;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;

          a {
            text-decoration: underline;
            transition: text-decoration 0.3s ease;

            &:hover {
              text-decoration: none;
            }
          }
        }
      }
    }
  </style>
</BlogPostLayout>
